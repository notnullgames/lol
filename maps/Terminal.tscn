[gd_scene load_steps=3 format=2]

[ext_resource path="res://basicfont.tres" type="DynamicFont" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends CanvasLayer

# eventually this will be set externally
# no extra spaces or comments, use zero-padded hex for numbers (00 for 0)
var code_text = \"\"\"S O 01   
S P 02   
S Q 03   
S R 04   
S T 01   
! 0D O G
! 0D P H
! 0D Q I
! 0D R J
= 10 K T
S M 00   
S N 14   
S M 01   
S K 01   
S L 01   
J 05     
S K 00   
S L 00   
J 05\"\"\"

# virtual machine registers
# eventually this will be set externally
var registers = {
	\"G\": 0x00,
	\"H\": 0x00,
	\"I\": 0x00,
	\"J\": 0x00,
	\"K\": 0x00,
	\"L\": 0x00,
	\"M\": 0x00,
	\"N\": 0x00,
	\"O\": 0x00,
	\"P\": 0x00,
	\"Q\": 0x00,
	\"R\": 0x00,
	\"S\": 0x00,
	\"T\": 0x00,
	\"U\": 0x00,
	\"V\": 0x00,
	\"W\": 0x00,
	\"X\": 0x00,
	\"Y\": 0x00,
	\"Z\": 0x00
}

var needs_help = false

# is it running?
var running = false

# entering an op?
var opmode = false

# current line/position
var line:int = 0
var pos:int = 0

# ops, with their help-text
const ops = {
	\"S\": \"SET: %s = %02X\",
	\"M\": \"MOVe: %s -> %s\",
	\"+\": \"ADD: %s + %s\",
	\"-\": \"SUBtract: %s - %s\",
	\"*\": \"MULtiply: %s * %s\",
	\"/\": \"DIVide: %s / %s\",
	\"J\": \"JuMP to line %02X\",
	\"=\": \"Jump to line %02X if EQual: %s == %s\",
	\"!\": \"Jump to line %02X if Not Equal: %s != %s\",
	\">\": \"Jump to line %02X if Greater Than: %s > %s\",
	\"<\": \"Jump to line %02X if Less Than: %s < %s\",
	null: \"No OPeration: do nothing\"
}

# track param-types, 0=number, 1=register
const params = {
	\"S\": [1, 0],
	\"M\": [1, 1],
	\"+\": [1, 1],
	\"-\": [1, 1],
	\"*\": [1, 1],
	\"/\": [1, 1],
	\"J\": [0],
	\"=\": [0, 1, 1],
	\"!\": [0, 1, 1],
	\">\": [0, 1, 1],
	\"<\": [0, 1, 1],
	null: []
}

# display textual code
func display_code(c:String):
	$LineIndicator.text = \"%02X : %d\" % [line, pos]
	var code = []
	code.resize(64)
	var l = -1
	for line in c.split(\"\\n\"):
		l += 1
		var d = line.split(\" \")
		var op = d[0]
		code[l] = op
		var p = 0
		for param in params[op]:
			p += 1
			code[l] += \" %2s\" % d[p]
	var out = []
	for i in range(64):
		if code[i] == null:
			if i < 16:
				out.append(\"          \")
			else:
				out[i % 16] = out[i % 16] + \" \" + \"          \"
		else:
			if i < 16:
				out.append(\"%-10s\" % code[i])
			else:
				out[i % 16] = out[i % 16] + \" \" + \"%-10s\" % code[i]
	$Code.bbcode_text = \"\"
	for i in out:
		$Code.bbcode_text += i + \"\\n\"
		

func _ready():
	display_code(code_text)
	
"

[node name="CanvasLayer" type="CanvasLayer"]
script = SubResource( 1 )

[node name="BG" type="ColorRect" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = -0.396851
margin_top = 0.396851
margin_right = -0.396851
margin_bottom = 0.396851
color = Color( 0, 0, 0, 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Code" type="RichTextLabel" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = 8.0
margin_top = 2.0
margin_right = 10.0
margin_bottom = -104.0
custom_fonts/normal_font = ExtResource( 1 )
bbcode_enabled = true
bbcode_text = "O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00"
text = "O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00
O 00 00 00 O 00 00 00 O 00 00 00 O 00 00 00"
scroll_active = false
__meta__ = {
"_edit_use_anchors_": false
}

[node name="div-bottom" type="ColorRect" parent="."]
margin_left = -1.0
margin_top = 132.0
margin_right = 319.0
margin_bottom = 142.0
color = Color( 0.968627, 0.968627, 0.968627, 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Brand" type="RichTextLabel" parent="."]
margin_left = 2.15047
margin_top = 134.335
margin_right = 75.1505
margin_bottom = 143.335
rect_clip_content = false
custom_fonts/normal_font = ExtResource( 1 )
bbcode_enabled = true
bbcode_text = "[color=red]Pakémon[/color]
"
text = "Pakémon
"
scroll_active = false
__meta__ = {
"_edit_use_anchors_": false
}

[node name="instructions" type="RichTextLabel" parent="."]
margin_left = 3.0
margin_top = 145.0
margin_right = 315.0
margin_bottom = 238.0
rect_clip_content = false
custom_fonts/normal_font = ExtResource( 1 )
text = "Use directionals to select position.
Hold A to with directionsals to change.
Press SELECT to run/stop.
Press B to exit.
"
fit_content_height = true
scroll_active = false
__meta__ = {
"_edit_use_anchors_": false
}

[node name="PlayIndicator" type="Label" parent="."]
margin_left = 310.0
margin_top = 133.621
margin_right = 318.0
margin_bottom = 141.621
custom_fonts/font = ExtResource( 1 )
text = ">"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="ColorRect" type="ColorRect" parent="."]
margin_left = 80.0
margin_right = 82.0
margin_bottom = 139.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="ColorRect2" type="ColorRect" parent="."]
margin_left = 157.298
margin_top = -1.78381
margin_right = 159.298
margin_bottom = 137.216
__meta__ = {
"_edit_use_anchors_": false
}

[node name="ColorRect3" type="ColorRect" parent="."]
margin_left = 234.002
margin_right = 236.002
margin_bottom = 139.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="LineIndicator" type="Label" parent="."]
margin_left = 274.973
margin_top = 230.189
margin_right = 317.973
margin_bottom = 239.189
custom_fonts/font = ExtResource( 1 )
text = "XX : X"
__meta__ = {
"_edit_use_anchors_": false
}
